<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WorthIT</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        .fade-in-fast { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .spinner {
            width: 56px;
            height: 56px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-black text-white">

    <div class="w-full max-w-md mx-auto p-6 min-h-screen flex flex-col justify-center">
        
        <header class="text-left mb-8">
            <h1 class="text-5xl font-extrabold text-white tracking-tighter">WorthIt<span class="text-[#FFB3C7]">.</span></h1>
            <p class="text-4xl font-bold text-white mt-4 leading-tight">Know the true<br>cost. Instantly.</p>
        </header>

        <main class="bg-white p-6 rounded-3xl shadow-2xl text-gray-800">
            <div class="space-y-5">
                <div>
                    <label for="productName" class="block text-sm font-medium text-gray-500">What's caught your eye?</label>
                    <input type="text" id="productName" placeholder="e.g., Google Pixel 7" class="mt-1 block w-full px-4 py-3 bg-gray-100 border-transparent rounded-xl focus:outline-none focus:ring-2 focus:ring-[#FFB3C7] sm:text-sm">
                </div>
                <div>
                    <label for="productPrice" class="block text-sm font-medium text-gray-500">How much is it? (£)</label>
                    <input type="number" id="productPrice" placeholder="e.g., 499" class="mt-1 block w-full px-4 py-3 bg-gray-100 border-transparent rounded-xl focus:outline-none focus:ring-2 focus:ring-[#FFB3C7] sm:text-sm">
                </div>
                <div>
                    <label for="productCategory" class="block text-sm font-medium text-gray-500">What is it?</label>
                    <select id="productCategory" class="mt-1 block w-full px-4 py-3 text-gray-800 bg-gray-100 border-transparent rounded-xl focus:outline-none focus:ring-2 focus:ring-[#FFB3C7] sm:text-sm">
                        <option disabled selected>Select a category...</option>
                        <option value="Electronics">Electronics</option>
                        <option value="Furniture">Furniture</option>
                        <option value="Clothing">Clothing</option>
                        <option value="Appliances">Appliances</option>
                        <option value="Tools">Tools</option>
                    </select>
                </div>
            </div>
            <button id="calculateBtn" class="mt-6 w-full bg-[#FFB3C7] text-black font-bold py-4 px-4 rounded-xl shadow-md hover:bg-pink-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-pink-500 transition-colors">
                Show Me the Value
            </button>
        </main>
    </div>

    <!-- Results Overlay (Initially Hidden) -->
    <div id="resultsOverlay" class="fixed inset-0 bg-black bg-opacity-70 backdrop-blur-sm flex items-center justify-center p-6 hidden fade-in-fast overflow-y-auto">
        <!-- Content (Spinner or Card) will be injected here -->
    </div>

    <script>
        const categoryData = {
            'Electronics': { lifespanYears: 4, usagePerWeek: 15, usageUnit: 'hour', usagePeriod: 'week' },
            'Furniture': { lifespanYears: 8, usagePerWeek: 7, usageUnit: 'day', usagePeriod: 'day' },
            'Clothing': { lifespanYears: 3, usagePerWeek: 2, usageUnit: 'wear', usagePeriod: 'week' },
            'Appliances': { lifespanYears: 7, usagePerWeek: 5, usageUnit: 'use', usagePeriod: 'week' },
            'Tools': { lifespanYears: 10, usagePerWeek: 1, usageUnit: 'use', usagePeriod: 'week' }
        };

        const calculateBtn = document.getElementById('calculateBtn');
        const resultsOverlay = document.getElementById('resultsOverlay');

        async function mockFetchProductData(productName) {
            console.log("Using mock data for:", productName);
            await new Promise(resolve => setTimeout(resolve, 1500));
            return {
                imageUrl: `https://placehold.co/600x400/F3F4F6/374151?text=${encodeURIComponent(productName)}`,
                deals: [
                    { source: 'Amazon UK', price: '£489.00', link: '#' },
                    { source: 'Currys', price: '£499.00', link: '#' },
                    { source: 'John Lewis', price: '£499.00', link: '#' }
                ]
            };
        }

        calculateBtn.addEventListener('click', async function() {
            const price = parseFloat(document.getElementById('productPrice').value);
            const category = document.getElementById('productCategory').value;
            const productName = document.getElementById('productName').value;

            if (isNaN(price) || !category || !productName) {
                alert("Please fill in all fields.");
                return;
            }

            resultsOverlay.classList.remove('hidden');
            resultsOverlay.innerHTML = `<div class="spinner"></div>`;

            try {
                // For the initial Netlify deploy, we use the mock function.
                // const productData = await mockFetchProductData(productName);
                
                // For Phase 2 (Live Data), you will comment out the line above
                // and uncomment the two lines below.
                const response = await fetch(`/.netlify/functions/get-product-data?productName=${encodeURIComponent(productName)}`);
                const productData = await response.json();

                if (productData.error) {
                    throw new Error(productData.error);
                }

                const data = categoryData[category];
                let totalUsage = 0;
                if (data.usagePeriod === 'week') totalUsage = data.lifespanYears * 52 * data.usagePerWeek;
                else if (data.usagePeriod === 'day') totalUsage = data.lifespanYears * 365;
                const costPerUse = price / totalUsage;

                let formattedCost = (costPerUse < 1) ? `${(costPerUse * 100).toFixed(0)}p` : `£${costPerUse.toFixed(2)}`;

                let dealsHtml = '<p class="text-sm text-gray-500">Live deals will appear here.</p>';
                if (productData.deals && productData.deals.length > 0) {
                    dealsHtml = productData.deals.map(deal => `
                        <a href="${deal.link}" target="_blank" rel="noopener noreferrer" class="flex items-center justify-between p-3 bg-gray-50 hover:bg-gray-100 rounded-xl transition-colors">
                            <span class="font-semibold text-gray-700">${deal.source}</span>
                            <span class="font-bold text-gray-900">${deal.price}</span>
                        </a>
                    `).join('');
                }

                resultsOverlay.innerHTML = `
                    <div class="bg-white p-6 rounded-3xl shadow-2xl text-gray-800 text-center w-full max-w-sm fade-in">
                        <img src="${productData.imageUrl || 'https://placehold.co/600x400/F3F4F6/374151?text=Image+Not+Found'}" alt="${productName}" class="rounded-2xl mb-6 w-full h-48 object-cover bg-gray-100">
                        <h2 class="text-4xl font-bold mb-2 text-gray-900">Worth It?</h2>
                        <h2 class="text-5xl font-extrabold text-gray-900 my-2">${formattedCost}</h2>
                        <p class="text-lg font-medium text-gray-700">per ${data.usageUnit}</p>
                        <div class="text-xs text-gray-400 mt-4 pt-4 border-t border-gray-200">
                            Calculated on average usage of a ${data.lifespanYears}-year lifespan with ${data.usagePerWeek} ${data.usageUnit}s per ${data.usagePeriod}.
                        </div>
                        
                        <div class="mt-6 text-left">
                            <h3 class="font-bold text-lg text-gray-800 mb-3">Live Deals</h3>
                            <div class="space-y-2">${dealsHtml}</div>
                        </div>
                    </div>
                `;

            } catch (error) {
                console.error("Error fetching product data:", error);
                resultsOverlay.innerHTML = `
                    <div class="bg-white p-8 rounded-3xl shadow-2xl text-gray-800 text-center w-full max-w-sm fade-in">
                         <h2 class="text-2xl font-bold mb-2 text-gray-900">Oops!</h2>
                         <p class="text-gray-600">We couldn't find that product. Please try a different name.</p>
                    </div>
                `;
            }
        });

        resultsOverlay.addEventListener('click', function(e) {
            if (e.target === resultsOverlay) {
                resultsOverlay.classList.add('hidden');
            }
        });
    </script>

</body>
</html>


